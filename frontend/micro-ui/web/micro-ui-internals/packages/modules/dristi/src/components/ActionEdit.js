import React, { useState } from "react";
import { useTranslation } from "react-i18next";
import { useHistory } from "react-router-dom";

export const Context = React.createContext();

const EditIcon = () => (
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_5427_18191)">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M18.2246 0.198856C18.2942 0.129011 18.377 0.0735972 18.4681 0.0357875C18.5592 -0.00202217 18.6569 -0.0214844 18.7556 -0.0214844C18.8542 -0.0214844 18.9519 -0.00202217 19.043 0.0357875C19.1341 0.0735972 19.2169 0.129011 19.2866 0.198856L23.7866 4.69886C23.8564 4.76852 23.9118 4.85129 23.9496 4.94241C23.9874 5.03352 24.0069 5.13121 24.0069 5.22986C24.0069 5.32851 23.9874 5.42619 23.9496 5.51731C23.9118 5.60842 23.8564 5.69119 23.7866 5.76086L8.78657 20.7609C8.71459 20.8323 8.62886 20.8885 8.53457 20.9259L1.03457 23.9259C0.898273 23.9804 0.748962 23.9938 0.605148 23.9643C0.461333 23.9348 0.329339 23.8637 0.22553 23.7599C0.12172 23.6561 0.0506596 23.5241 0.0211584 23.3803C-0.00834277 23.2365 0.00501248 23.0872 0.0595685 22.9509L3.05957 15.4509C3.09696 15.3566 3.15309 15.2708 3.22457 15.1989L18.2246 0.198856ZM16.8161 3.72986L20.2556 7.16936L22.1951 5.22986L18.7556 1.79036L16.8161 3.72986ZM19.1951 8.22986L15.7556 4.79036L6.00557 14.5404V14.9799H6.75557C6.95448 14.9799 7.14525 15.0589 7.2859 15.1995C7.42655 15.3402 7.50557 15.5309 7.50557 15.7299V16.4799H8.25557C8.45448 16.4799 8.64525 16.5589 8.7859 16.6995C8.92655 16.8402 9.00557 17.0309 9.00557 17.2299V17.9799H9.44507L19.1951 8.22986ZM4.55357 15.9924L4.39457 16.1514L2.10257 21.8829L7.83407 19.5909L7.99307 19.4319C7.85 19.3784 7.72666 19.2825 7.63954 19.1571C7.55242 19.0316 7.50568 18.8826 7.50557 18.7299V17.9799H6.75557C6.55666 17.9799 6.36589 17.9008 6.22524 17.7602C6.08459 17.6195 6.00557 17.4288 6.00557 17.2299V16.4799H5.25557C5.10284 16.4797 4.95378 16.433 4.82833 16.3459C4.70289 16.2588 4.60702 16.1354 4.55357 15.9924Z"
        fill="#00703C"
      />
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M18.2246 0.198856C18.2942 0.129011 18.377 0.0735972 18.4681 0.0357875C18.5592 -0.00202217 18.6569 -0.0214844 18.7556 -0.0214844C18.8542 -0.0214844 18.9519 -0.00202217 19.043 0.0357875C19.1341 0.0735972 19.2169 0.129011 19.2866 0.198856L23.7866 4.69886C23.8564 4.76852 23.9118 4.85129 23.9496 4.94241C23.9874 5.03352 24.0069 5.13121 24.0069 5.22986C24.0069 5.32851 23.9874 5.42619 23.9496 5.51731C23.9118 5.60842 23.8564 5.69119 23.7866 5.76086L8.78657 20.7609C8.71459 20.8323 8.62886 20.8885 8.53457 20.9259L1.03457 23.9259C0.898273 23.9804 0.748962 23.9938 0.605148 23.9643C0.461333 23.9348 0.329339 23.8637 0.22553 23.7599C0.12172 23.6561 0.0506596 23.5241 0.0211584 23.3803C-0.00834277 23.2365 0.00501248 23.0872 0.0595685 22.9509L3.05957 15.4509C3.09696 15.3566 3.15309 15.2708 3.22457 15.1989L18.2246 0.198856ZM16.8161 3.72986L20.2556 7.16936L22.1951 5.22986L18.7556 1.79036L16.8161 3.72986ZM19.1951 8.22986L15.7556 4.79036L6.00557 14.5404V14.9799H6.75557C6.95448 14.9799 7.14525 15.0589 7.2859 15.1995C7.42655 15.3402 7.50557 15.5309 7.50557 15.7299V16.4799H8.25557C8.45448 16.4799 8.64525 16.5589 8.7859 16.6995C8.92655 16.8402 9.00557 17.0309 9.00557 17.2299V17.9799H9.44507L19.1951 8.22986ZM4.55357 15.9924L4.39457 16.1514L2.10257 21.8829L7.83407 19.5909L7.99307 19.4319C7.85 19.3784 7.72666 19.2825 7.63954 19.1571C7.55242 19.0316 7.50568 18.8826 7.50557 18.7299V17.9799H6.75557C6.55666 17.9799 6.36589 17.9008 6.22524 17.7602C6.08459 17.6195 6.00557 17.4288 6.00557 17.2299V16.4799H5.25557C5.10284 16.4797 4.95378 16.433 4.82833 16.3459C4.70289 16.2588 4.60702 16.1354 4.55357 15.9924Z"
        fill="#00703C"
      />
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M18.2246 0.198856C18.2942 0.129011 18.377 0.0735972 18.4681 0.0357875C18.5592 -0.00202217 18.6569 -0.0214844 18.7556 -0.0214844C18.8542 -0.0214844 18.9519 -0.00202217 19.043 0.0357875C19.1341 0.0735972 19.2169 0.129011 19.2866 0.198856L23.7866 4.69886C23.8564 4.76852 23.9118 4.85129 23.9496 4.94241C23.9874 5.03352 24.0069 5.13121 24.0069 5.22986C24.0069 5.32851 23.9874 5.42619 23.9496 5.51731C23.9118 5.60842 23.8564 5.69119 23.7866 5.76086L8.78657 20.7609C8.71459 20.8323 8.62886 20.8885 8.53457 20.9259L1.03457 23.9259C0.898273 23.9804 0.748962 23.9938 0.605148 23.9643C0.461333 23.9348 0.329339 23.8637 0.22553 23.7599C0.12172 23.6561 0.0506596 23.5241 0.0211584 23.3803C-0.00834277 23.2365 0.00501248 23.0872 0.0595685 22.9509L3.05957 15.4509C3.09696 15.3566 3.15309 15.2708 3.22457 15.1989L18.2246 0.198856ZM16.8161 3.72986L20.2556 7.16936L22.1951 5.22986L18.7556 1.79036L16.8161 3.72986ZM19.1951 8.22986L15.7556 4.79036L6.00557 14.5404V14.9799H6.75557C6.95448 14.9799 7.14525 15.0589 7.2859 15.1995C7.42655 15.3402 7.50557 15.5309 7.50557 15.7299V16.4799H8.25557C8.45448 16.4799 8.64525 16.5589 8.7859 16.6995C8.92655 16.8402 9.00557 17.0309 9.00557 17.2299V17.9799H9.44507L19.1951 8.22986ZM4.55357 15.9924L4.39457 16.1514L2.10257 21.8829L7.83407 19.5909L7.99307 19.4319C7.85 19.3784 7.72666 19.2825 7.63954 19.1571C7.55242 19.0316 7.50568 18.8826 7.50557 18.7299V17.9799H6.75557C6.55666 17.9799 6.36589 17.9008 6.22524 17.7602C6.08459 17.6195 6.00557 17.4288 6.00557 17.2299V16.4799H5.25557C5.10284 16.4797 4.95378 16.433 4.82833 16.3459C4.70289 16.2588 4.60702 16.1354 4.55357 15.9924Z"
        fill="#00703C"
      />
    </g>
    <defs>
      <clipPath id="clip0_5427_18191">
        <rect width="24" height="24" fill="white" />
      </clipPath>
    </defs>
  </svg>
);

const ActionEdit = ({ column, row, master, module }) => {
  const { t } = useTranslation();
  const [isDropdownOpen, setIsDropdownOpen] = useState(false);
  const history = useHistory();

  const dropdownItems = Digit.Customizations[master]?.[module]?.dropDownItems?.(row, column, t) || [];

  const filteredDropdownItems = dropdownItems.filter((item) => !item.hide);

  const toggleDropdown = () => {
    setIsDropdownOpen(!isDropdownOpen);
  };

  return (
    <div style={{ position: "absolute", display: "flex", justifyContent: "center", alignItems: "center", width: "40px", height: 0 }}>
      <div
        style={{
          cursor: "pointer",
        }}
        onClick={toggleDropdown}
      >
        <EditIcon />
      </div>

      {isDropdownOpen && (
        <ul
          style={{
            position: "absolute",
            right: 0,
            backgroundColor: "white",
            border: "1px solid #ccc",
            listStyle: "none",
            padding: 0,
            margin: 0,
            top: "10px",
            width: "200px",
            zIndex: 1000,
          }}
        >
          {filteredDropdownItems.map((item) => (
            <li
              key={item.id}
              style={{ padding: "10px", cursor: "pointer", color: item.disabled ? "grey" : "black" }}
              onClick={() => {
                setIsDropdownOpen(false);
                return !item.disabled && item.action(history, column, row, item);
              }}
            >
              {t(item.label)}
            </li>
          ))}
          {Array.isArray(filteredDropdownItems) && filteredDropdownItems.length === 0 && (
            <p style={{ padding: "5px" }}>{t("ACTIONS_NOT_AVAILABLE")}</p>
          )}
        </ul>
      )}
    </div>
  );
};

export default ActionEdit;
